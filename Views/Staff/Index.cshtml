@model EMiningLicense.Models.StaffDashboardVm
@{
    ViewBag.Title = "Staff Dashboard - E-Mining License Platform";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-success fw-bold">
            <i class="fas fa-user-tie"></i> Staff Dashboard
        </h2>
        <a href="@Url.Action("Profile", "Staff")" class="btn btn-success shadow-sm">
            <i class="fas fa-user-cog"></i> Edit Profile
        </a>
    </div>

    <!-- Notifications -->
    @if (Model?.Notifications?.Any() == true)
    {
        <div class="alert alert-success shadow-sm">
            <h5 class="mb-2"><i class="fas fa-bell"></i> Notifications</h5>
            <ul class="mb-0 ps-3">
                @foreach (var note in Model.Notifications)
                {
                    <li>@note</li>
                }
            </ul>
        </div>
    }

    <!-- New Applications -->
    <div class="card shadow mb-4">
        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-folder-plus"></i> New Applications</h5>
            <span class="badge bg-dark">@Model.NewApplications.Count()</span>
        </div>
        <div class="card-body">
            @if (Model.NewApplications != null && Model.NewApplications.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-warning">
                            <tr>
                                <th>Applicant</th>
                                <th>Company</th>
                                <th>License Type</th>
                                <th>Status</th>
                                <th>Submitted At</th>
                                <th>Document</th>
                                <th>Location</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var app in Model.NewApplications)
                            {
                                <tr>
                                    <td>@app.ApplicantName</td>
                                    <td>@app.CompanyName</td>
                                    <td>@app.LicenseType</td>
                                    <td>
                                        <span class="badge @(app.Status == "Approved" ? "bg-success" : "bg-warning text-dark")">
                                            @app.Status
                                        </span>
                                    </td>
                                    <td>@app.SubmittedAt.ToString("dd/MM/yyyy")</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(app.DocumentPath))
                                        {
                                            <a href="@Url.Content(app.DocumentPath)"
                                               class="btn btn-sm btn-outline-primary" target="_blank" title="View Document">
                                                <i class="fas fa-file-alt"></i> View
                                            </a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No document</span>
                                        }
                                    </td>
                                    <td>
                                        @if (app.Latitude != null && app.Longitude != null)
                                        {
                                            <a href="https://www.google.com/maps?q=@app.Latitude,@app.Longitude"
                                               target="_blank" class="btn btn-sm btn-outline-info" title="View Location">
                                                <i class="fas fa-map-marker-alt"></i> Map
                                            </a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No location</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <a href="@Url.Action("Review", "Staff", new { id = app.Id })"
                                           class="btn btn-sm btn-success me-1">
                                            <i class="fas fa-check-circle"></i> Review
                                        </a>
                                        <a href="@Url.Action("Details", "Staff", new { id = app.Id })"
                                           class="btn btn-sm btn-info">
                                            <i class="fas fa-eye"></i> Details
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-muted text-center mb-0">✅ No new applications to review at the moment.</p>
            }
        </div>
    </div>

    <!-- Assigned Applications -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-clipboard-list"></i> Assigned Applications</h5>
            <a href="#" class="btn btn-light btn-sm"><i class="fas fa-plus-circle"></i> New Assignment</a>
        </div>
        <div class="card-body">
            @if (Model.AssignedApplications != null && Model.AssignedApplications.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-success">
                            <tr>
                                <th>Applicant</th>
                                <th>License Type</th>
                                <th>Status</th>
                                <th>Submitted At</th>
                                <th>Document</th>
                                <th>Location</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var app in Model.AssignedApplications)
                            {
                                <tr>
                                    <td>@app.ApplicantName</td>
                                    <td>@app.LicenseType</td>
                                    <td>
                                        <span class="badge @(app.Status == "Approved" ? "bg-success" : "bg-warning text-dark")">
                                            @app.Status
                                        </span>
                                    </td>
                                    <td>@app.SubmittedAt.ToString("dd/MM/yyyy")</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(app.DocumentPath))
                                        {
                                            <a href="@Url.Content(app.DocumentPath)"
                                               class="btn btn-sm btn-outline-primary" target="_blank" title="View Document">
                                                <i class="fas fa-file-alt"></i> View
                                            </a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No document</span>
                                        }
                                    </td>
                                    <td>
                                        @if (app.Latitude != null && app.Longitude != null)
                                        {
                                            <a href="https://www.google.com/maps?q=@app.Latitude,@app.Longitude"
                                               target="_blank" class="btn btn-sm btn-outline-info" title="View Location">
                                                <i class="fas fa-map-marker-alt"></i> Map
                                            </a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No location</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <a href="@Url.Action("Review", "Staff", new { id = app.Id })"
                                           class="btn btn-sm btn-success me-1">
                                            <i class="fas fa-check-circle"></i> Review
                                        </a>
                                        <a href="@Url.Action("Details", "Staff", new { id = app.Id })"
                                           class="btn btn-sm btn-info">
                                            <i class="fas fa-eye"></i> Details
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-muted text-center mb-0">✅ No assigned applications at the moment.</p>
            }
        </div>
    </div>
</div>
